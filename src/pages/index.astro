---
import Layout from '../layouts/Layout.astro';
import BookList from '../components/BookList.tsx';
import { prisma } from '../lib/prisma';


// const books = await response.json();
const books = await prisma.book.findMany({
	include: {
		genres: true,
		authors: true
	}
});
console.log(books);

async function deleteBook(id: number) {
  if (confirm("Are you sure you want to delete this book?")) {
    await fetch(`/api/books/${id}`, { method: 'DELETE' });
    window.location.reload(); // Simple reload for now, consider better state management
  }
}
---

<Layout title="Book Library">
  <main class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">My Book Library</h1>
    <div class="mb-4">
      <a href="/books/add" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Add New Book</a>
    </div>
    <BookList onDelete={deleteBook} client:load />
  </main>
</Layout>