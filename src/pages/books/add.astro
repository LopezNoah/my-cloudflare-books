---
import Layout from '../../layouts/Layout.astro';
import BookForm from '../../components/BookForm.tsx';
import { prisma } from '../../lib/prisma';

const response = await fetch('/api/genres');
// const genres = await response.json();
const genres = await prisma.genre.findMany();

async function handleAddBook(bookData: any) {
  const response = await fetch('/api/books', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(bookData),
  });
  if (response.ok) {
    window.location.href = '/'; // Redirect to book list after adding
  } else {
    alert('Failed to add book'); // Basic error handling
    console.error('Error adding book:', await response.json());
  }
}
---

<Layout title="Add Book">
  <main class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Add New Book</h1>
    <BookForm genres={genres} onSubmit={handleAddBook} client:load />
  </main>
</Layout>